<!DOCTYPE node PUBLIC "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd">
<!--
  SPDX-License-Identifier: CC0-1.0
  SPDX-FileCopyrightText: none
-->
<node>
    <!--
        The request callback interface. This interface needs to be implemented
        by the caller of the prompt methods. It acts as a callback point for
        the prompter. As such the method/signal use is inverted here.
        Methods are called by the prompter to deliver results.
        Signals are emitted by you to request changes to the prompt state.
        This is the version 1 of the protocol.
    -->
    <interface name="org.kde.secretprompter.request">
        <!-- Called when the user accepted a prompt and gave the desired data -->
        <method name="Accepted">
            <!--
                The file descriptor to read the secret from. Data is written as UTF-8 text and can be read until EOF.
                It is nonblocking so it can easily be consumed by async IO loops.
            -->
            <arg name="result" type="h" direction="in"/>
            <!--
                What to do with the prompt after this method.

                0 = Dismiss prompt
                1 = Keep prompt (e.g. for retry)

                Returning an error will be treated as action=0.
            -->
            <arg name="action" type="i" direction="out"/>
        </method>

        <!-- Called when the user rejected the prompt (i.e. cancelled it) -->
        <method name="Rejected">
            <!--
                What to do with the prompt after this method.

                0 = Dismiss prompt
                1 = Keep prompt (e.g. for retry)

                Returning an error will be treated as action=0.
            -->
            <arg name="action" type="i" direction="out"/>
        </method>

        <!--
            Called when the prompt is being dismissed. No further calls will be made after this and no signals will be
            listened to. This allows you to clean up any state you have associated with this request interface object.

            This can happen in respones to you:
            - emitting the Dismiss signal
            - returning action=0 from Result
        -->
        <method name="Dismissed">
        </method>

        <!--
            When emitted the prompt will be shown again with a reason being visualized.
            Of use when the secret was incorrect (unlock) or not strong enough (create).
            Note that sessions are automatically closed after a short while so you should make the decision
            to retry in a reasonable time frame of less than 30 seconds.
        -->
        <signal name="Retry">
            <!-- The reason for why the prompt is being retried. This is required! -->
            <arg name="reason" type="s" direction="in"/>
        </signal>

        <!--
            Emit when you are done with this requests.
            You will not get any further calls nor will signals be listened to.
        -->
        <signal name="Dismiss">
        </signal>
    </interface>
</node>
